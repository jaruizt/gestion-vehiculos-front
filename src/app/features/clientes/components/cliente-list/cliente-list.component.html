<div class="clientes-container">
  <div class="container-fluid">
    <!-- Header -->
    <div class="page-header">
      <div>
        <h1>
          <i class="bi bi-people-fill"></i>
          Gestión de Clientes
        </h1>
        <p class="page-subtitle">Administra los clientes</p>
      </div>
      <button class="btn btn-primary" (click)="abrirModalCrear()">
        <i class="bi bi-plus-circle"></i>
        Nuevo Cliente
      </button>
    </div>

    <!-- Filtros -->
    <div class="filters-container">
      <div class="row g-3">
        <div class="col-md-5">
          <div class="search-box">
            <i class="bi bi-search"></i>
            <input
              type="text"
              class="form-control"
              placeholder="Buscar por DNI, nombre, email o teléfono..."
              [(ngModel)]="filtroTexto"
              (input)="aplicarFiltros()"
            />
          </div>
        </div>
        <div class="col-md-3">
          <select class="form-select" [(ngModel)]="filtroTipo" (change)="aplicarFiltros()">
            <option value="">Todos los tipos</option>
            <option value="PARTICULAR">Particular</option>
            <option value="EMPRESA">Empresa</option>
            <option value="AUTONOMO">Autónomo</option>
          </select>
        </div>
        <div class="col-md-2">
          <button class="btn btn-outline-primary w-100" (click)="limpiarFiltros()">
            <i class="bi bi-x-circle"></i>
            Limpiar
          </button>
        </div>
      </div>
    </div>

    <!-- Loading -->
    <div *ngIf="loading" class="spinner-container">
      <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
      </div>
    </div>

    <!-- Tabla de Clientes -->
    <div *ngIf="!loading && clientesFiltrados.length > 0" class="table-container fade-in">
      <table class="table">
        <thead>
          <tr>
            <th>DNI/CIF</th>
            <th>Nombre</th>
            <th>Tipo</th>
            <th>Email</th>
            <th>Teléfono</th>
            <th>Dirección</th>
            <th class="text-end">Acciones</th>
          </tr>
        </thead>
        <tbody>
          <tr *ngFor="let cliente of clientesFiltrados">
            <td>
              <strong class="text-primary">{{ cliente.dni }}</strong>
            </td>
            <td>{{ cliente.nombre }}</td>
            <td>
              <span class="badge" [ngClass]="obtenerClaseTipo(cliente.tipoCliente)">
                {{ cliente.tipoCliente }}
              </span>
            </td>
                <td>
                <a *ngIf="cliente.email" [href]="'mailto:' + cliente.email" class="text-info">
                    <i class="bi bi-envelope"></i>
                    {{ cliente.email }}
                </a>
                <span *ngIf="!cliente.email" class="text-muted">-</span>
                </td>
                <td>
                <a *ngIf="cliente.telefono" [href]="'tel:' + cliente.telefono" class="text-info">
                    <i class="bi bi-telephone"></i>
                    {{ cliente.telefono }}
                </a>
                <span *ngIf="!cliente.telefono" class="text-muted">-</span>
                </td>
            <td>
              <small class="text-muted">{{ cliente.direccion }}</small>
            </td>
            <td>
              <div class="action-buttons justify-content-end">
                <button
                  class="btn btn-sm btn-outline-primary"
                  (click)="verDetalle(cliente)"
                  title="Ver detalle"
                >
                  <i class="bi bi-eye"></i>
                </button>
                <button
                  class="btn btn-sm btn-outline-warning"
                  (click)="abrirModalEditar(cliente)"
                  title="Editar"
                >
                  <i class="bi bi-pencil"></i>
                </button>
                <button
                  class="btn btn-sm btn-outline-danger"
                  (click)="confirmarEliminar(cliente)"
                  title="Eliminar"
                >
                  <i class="bi bi-trash"></i>
                </button>
              </div>
            </td>
          </tr>
        </tbody>
      </table>
    </div>

    <!-- Empty State -->
    <div *ngIf="!loading && clientesFiltrados.length === 0" class="empty-state">
      <i class="bi bi-people"></i>
      <h5>No hay clientes</h5>
      <p *ngIf="filtroTexto || filtroTipo">
        No se encontraron clientes con los filtros aplicados
      </p>
      <p *ngIf="!filtroTexto && !filtroTipo">
        Agrega el primer cliente
      </p>
      <button class="btn btn-primary" (click)="abrirModalCrear()">
        <i class="bi bi-plus-circle"></i>
        Agregar Cliente
      </button>
    </div>
  </div>
</div>

<!-- Modal Crear/Editar -->
<app-cliente-form
  *ngIf="mostrarModal"
  [cliente]="clienteSeleccionado"
  [esEdicion]="esEdicion"
  (cerrar)="cerrarModal()"
  (guardado)="onClienteGuardado()"
></app-cliente-form>