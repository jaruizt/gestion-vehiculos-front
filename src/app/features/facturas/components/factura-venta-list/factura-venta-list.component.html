<div class="facturas-venta-content">
  <!-- Header con botón -->
  <div class="content-header">
    <button class="btn btn-primary" (click)="abrirModalCrear()">
      <i class="bi bi-plus-circle"></i>
      Nueva Factura de Venta
    </button>
  </div>

  <!-- Filtros -->
  <div class="filters-container">
    <div class="row g-3">
      <div class="col-md-8">
        <div class="search-box">
          <i class="bi bi-search"></i>
          <input
            type="text"
            class="form-control"
            placeholder="Buscar por número de factura, matrícula o cliente..."
            [(ngModel)]="filtroTexto"
            (input)="aplicarFiltros()"
          />
        </div>
      </div>
      <div class="col-md-4">
        <button class="btn btn-outline-primary w-100" (click)="limpiarFiltros()">
          <i class="bi bi-x-circle"></i>
          Limpiar
        </button>
      </div>
    </div>
  </div>

  <!-- Loading -->
  <div *ngIf="loading" class="spinner-container">
    <div class="spinner-border text-primary" role="status">
      <span class="visually-hidden">Cargando...</span>
    </div>
  </div>

  <!-- Tabla -->
  <div *ngIf="!loading && facturasFiltradas.length > 0" class="table-container fade-in">
    <table class="table">
      <thead>
        <tr>
          <th>Nº Factura</th>
          <th>Fecha</th>
          <th>Vehículo</th>
          <th>Cliente</th>
          <th>Importe</th>
          <th>Beneficio</th>
          <th class="text-end">Acciones</th>
        </tr>
      </thead>
      <tbody>
        <tr *ngFor="let factura of facturasFiltradas">
          <td>
            <strong class="text-primary">{{ factura.numeroFactura }}</strong>
          </td>
          <td>{{ factura.fechaFactura | date:'dd/MM/yyyy' }}</td>
          <td>
            <div>
              <strong>{{ factura.vehiculoMatricula }}</strong>
              <br>
              <small class="text-muted">{{ factura.vehiculoMarcaModelo }}</small>
            </div>
          </td>
          <td>
            <div>
              {{ factura.clienteNombre }}
              <br>
              <small class="text-muted">{{ factura.clienteDni }}</small>
            </div>
          </td>
          <td>
            <strong class="text-success">{{ factura.importeTotal | number:'1.2-2' }} €</strong>
          </td>
          <td>
            <strong *ngIf="factura.beneficio !== undefined && factura.beneficio !== null" 
                    [class.text-success]="factura.beneficio > 0"
                    [class.text-danger]="factura.beneficio < 0">
              {{ factura.beneficio | number:'1.2-2' }} €
            </strong>
            <span *ngIf="factura.beneficio === undefined || factura.beneficio === null" class="text-muted">-</span>
          </td>
          <td>
            <div class="action-buttons justify-content-end">
              <button
                class="btn btn-sm btn-outline-primary"
                (click)="verDetalle(factura)"
                title="Ver detalle"
              >
                <i class="bi bi-eye"></i>
              </button>
              <button
                class="btn btn-sm btn-outline-warning"
                (click)="abrirModalEditar(factura)"
                title="Editar"
              >
                <i class="bi bi-pencil"></i>
              </button>
              <button
                class="btn btn-sm btn-outline-danger"
                (click)="confirmarEliminar(factura)"
                title="Eliminar"
              >
                <i class="bi bi-trash"></i>
              </button>
            </div>
          </td>
        </tr>
      </tbody>
    </table>
  </div>

  <!-- Empty State -->
  <div *ngIf="!loading && facturasFiltradas.length === 0" class="empty-state">
    <i class="bi bi-receipt"></i>
    <h5>No hay facturas de venta</h5>
    <p *ngIf="filtroTexto">
      No se encontraron facturas con los filtros aplicados
    </p>
    <p *ngIf="!filtroTexto">
      Comienza registrando tu primera factura de venta
    </p>
    <button class="btn btn-primary" (click)="abrirModalCrear()">
      <i class="bi bi-plus-circle"></i>
      Crear Factura
    </button>
  </div>
</div>

<!-- Modal -->
<app-factura-venta-form
  *ngIf="mostrarModal"
  [factura]="facturaSeleccionada"
  [esEdicion]="esEdicion"
  (cerrar)="cerrarModal()"
  (guardado)="onFacturaGuardada()"
></app-factura-venta-form>